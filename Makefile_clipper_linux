#
# Sigma-com Zenica 2002-2006
#
# authors:
#  - ernad.husremovic@sigma-com.net
#

BUILD_ENV_LINUX=1

LIBSUFFIX=

LIBEXT=.lib


SC_BUILD_ROOT_DOS=c:\\dev
CLIPPERCOMP=$(SC_BUILD_HOME_DIR)/sclib/clipper.rb
CLIPPERFLAGS0=/n /q /DC52 /D$(VERZIJA) /DDBUILD='00' /ustd_cdx.ch
CLIPPERROOT=$(SC_BUILD_HOME_DIR)/clp_bc/clipper
CLIPPERROOT_DOS=c:\\dev\clp_bc\\clipper

EXEDEST=$(SC_BUILD_HOME_DIR)/sigma
EXEDOSDEST=c:\\dev\\sc\\exe

LINKEREXE=$(SC_BUILD_HOME_DIR)/sclib/blink_linux.sh
LIBEXE=$(SC_BUILD_HOME_DIR)/sclib/clipper.rb --make-lib 

#asembler
ASMFLAGS=

#c kompajler
CFLAGS=/n /w /c /AL /FPa /Gs /Zl

ROBODOC=robodoc

ifndef DEBUG
 DEBUG=0
endif  

ifndef VERZIJA
 VERZIJA=CDX
endif
	
ifeq "$(DEBUG)" "1"
 CLIPPERFLAGS=/b /DPROBA $(CLIPPERFLAGS0)
 DEBUGLINK=file $(CLIPPERROOT_DOS)\\lib\\CLD.LIB
 DEBUGDIR=/debug
 DEBUGDIR2=DEBUG\\
else
 CLIPPERFLAGS=$(CLIPPERFLAGS0)
 DEBUGLINK=
 DEBUGDIR=
 DEBUGDIR2=
endif

ifeq "$(DEBUG)" "1"
 LIB_DEST=$(SC_BUILD_HOME_DIR)/sc/lib/debug/

else
 LIB_DEST=$(SC_BUILD_HOME_DIR)/sc/lib/
endif


ifeq "${PP}" "1"
 CLIPPERFLAGS += /p
endif

ifeq "${LIB}" "1"
 CLIPPERFLAGS += /DLIB
endif



lib : $(OBJS)
	rm -f $(MODUL)$(LIBEXT) 
	$(LIBEXE) "$(MODUL)$(LIBEXT) $(LIBCMD) $(LIBSUFFIX)"
	cp $(MODUL)$(LIBEXT) $(LIB_DEST)

exe: $(OBJS)
	$(SC_BUILD_HOME_DIR)/sclib/gen_bl_lnk.sh create $(FMKLIBCMD)
	$(SC_BUILD_HOME_DIR)/sclib/gen_bl_lnk.sh add $(LINKCMD)
	$(SC_BUILD_HOME_DIR)/sclib/clipper.rb $(DBG) --output-exe "e.exe" --blink $(CURR_DIR) 
	mv $(CURR_DIR)/e.exe $(SC_BUILD_HOME_DIR)/sc/exe/$(MODUL).exe 

zip:
	$(SC_BUILD_HOME_DIR)/sclib/zip.sh h:\\cs\\FMK\\binary\\$(MODUL).zip ..\\chs\\\*.chs c:\\dev\\fmk\af\cl-af\\svi\\\*.chs ..\template\\\*.txt $(EXEDOSDEST)\\$(MODUL).EXE

commit:
	$(SC_BUILD_HOME_DIR)/sclib/commit.sh $(MODUL) h:\\cs\\FMK\\binary\\$(MODUL).zip
	$(SC_BUILD_HOME_DIR)/sclib/commit.sh $(MODUL) h:\\cs\\FMK\\binary\\sfx\\$(MODUL).exe

7exe:
	$(SC_BUILD_HOME_DIR)/sclib/7exe.sh h:\\cs\\fmk\\binary\\sfx\\$(MODUL).exe ..\\chs\\\*.chs \\dev\\fmk\\af\\cl-af\\svi\\\*.chs ..\\template\\\*.txt $(EXEDOSDEST)\\$(MODUL).EXE



%.obj : %.prg  
	$(CLIPPERCOMP) --switches '$(CLIPPERFLAGS)' --compile $< 
	#$(CLIPPERCOMP) --switches '$(CLIPPERFLAGS)' --compile-all "$(SRCDOSROOT) $(PRGS)"

.asm.obj:
	$(CLIPPERCOMP) --switches '$(ASMFLAGS)' --asm-compile $< 

.c.obj:
	$(CLIPPERCOMP) --switches '$(CFLAGS)' --c-compile $< 


